



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="A Data Science documentation website.">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.2.0">
    
    
      
        <title>Codecademy, SQL, Analyzing Business Metrics - ugodoc</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.572ca0f0.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#546e7a">
      
    
    
      <script src="../assets/javascripts/modernizr.8c900955.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue-grey" data-md-color-accent="red">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#specifying-comments" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="ugodoc" class="md-header-nav__button md-logo">
          
            <i class="md-icon">layers</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                ugodoc
              </span>
              <span class="md-header-nav__topic">
                Codecademy, SQL, Analyzing Business Metrics
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/ugoproto/ugodoc.git/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      ugoproto/ugodoc
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="ugodoc" class="md-nav__button md-logo">
      
        <i class="md-icon">layers</i>
      
    </a>
    ugodoc
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/ugoproto/ugodoc.git/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      ugoproto/ugodoc
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Vade Mecum
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Vade Mecum
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../charts/" title="Charts" class="md-nav__link">
      Charts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../digital_humanities/" title="Digital Humanities" class="md-nav__link">
      Digital Humanities
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../edition_cs/" title="Edition Cheat Sheets" class="md-nav__link">
      Edition Cheat Sheets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../infographies/" title="Infographies" class="md-nav__link">
      Infographies
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../latex_snippets/" title="LaTeX Snippets" class="md-nav__link">
      LaTeX Snippets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../resources_for_data_science/" title="Resources for Data Science" class="md-nav__link">
      Resources for Data Science
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../storytelling_with_data/" title="Storytelling with Data" class="md-nav__link">
      Storytelling with Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ten_stories_data/" title="Ten Kinds of Stories to Tell with Data" class="md-nav__link">
      Ten Kinds of Stories to Tell with Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dix_recits_donnees/" title="Dix trames de récits avec des données" class="md-nav__link">
      Dix trames de récits avec des données
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../visual_perception/" title="Visual Perception (visualisation)" class="md-nav__link">
      Visual Perception (visualisation)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      OS & CLI
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        OS & CLI
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../os_cs/" title="OS Cheat Sheets" class="md-nav__link">
      OS Cheat Sheets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../codecademy_learn_the_command_line_notes/" title="Codecademy, Learn the Command Line Notes" class="md-nav__link">
      Codecademy, Learn the Command Line Notes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../command_line_crash_course/" title="Command Line Crash Course" class="md-nav__link">
      Command Line Crash Course
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../command_shell_snippets/" title="Command Shell Snippets" class="md-nav__link">
      Command Shell Snippets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cli_regex_git/" title="CLI, regex, and Git" class="md-nav__link">
      CLI, regex, and Git
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../the_linux_command_line/" title="The Linux Command Line" class="md-nav__link">
      The Linux Command Line
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../usefull_shell_commands_for_data_science/" title="Useful Shell Commands for Data Science" class="md-nav__link">
      Useful Shell Commands for Data Science
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      SQL & NoSQL
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        SQL & NoSQL
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../sql_nosql_cs/" title="SQL-NoSQL Cheat Sheets" class="md-nav__link">
      SQL-NoSQL Cheat Sheets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../codecademy_learn_sql/" title="Codecademy, Learn SQL" class="md-nav__link">
      Codecademy, Learn SQL
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Codecademy, SQL, Analyzing Business Metrics
      </label>
    
    <a href="./" title="Codecademy, SQL, Analyzing Business Metrics" class="md-nav__link md-nav__link--active">
      Codecademy, SQL, Analyzing Business Metrics
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#specifying-comments" title="Specifying Comments" class="md-nav__link">
    Specifying Comments
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#avanced-aggregates" title="Avanced Aggregates" class="md-nav__link">
    Avanced Aggregates
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-metrics" title="Common Metrics" class="md-nav__link">
    Common Metrics
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../codecademy_sql_table_transformation/" title="Codecademy, SQL, Table Transformation" class="md-nav__link">
      Codecademy, SQL, Table Transformation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../introduction_to_sql_joins/" title="Introduction to SQL JOINs" class="md-nav__link">
      Introduction to SQL JOINs
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Web
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Web
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../embedding/" title="Embedding HTML into HTML" class="md-nav__link">
      Embedding HTML into HTML
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../html_and_css/" title="HTML and CSS" class="md-nav__link">
      HTML and CSS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../responsive_html/" title="Responsive HTML" class="md-nav__link">
      Responsive HTML
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#specifying-comments" title="Specifying Comments" class="md-nav__link">
    Specifying Comments
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#avanced-aggregates" title="Avanced Aggregates" class="md-nav__link">
    Avanced Aggregates
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-metrics" title="Common Metrics" class="md-nav__link">
    Common Metrics
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ugoproto/ugodoc.git/edit/master/docs/codecademy_sql_analyzing_business_metrics.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Codecademy, SQL, Analyzing Business Metrics</h1>
                
                <p><strong>Foreword</strong></p>
<p>Code snippets. With SQLite. From Codecademy in collaboration with <a href="https://www.periscopedata.com">Periscope Data</a>.</p>
<hr />
<h2 id="specifying-comments">Specifying Comments<a class="headerlink" href="#specifying-comments" title="Permanent link">&para;</a></h2>
<ul>
<li>Line comment. This is indicated by two negative signs. The remainder of the text on the line is the comment.</li>
<li>Block comment. The start of the block comment is indicated by <code class="codehilite"><span class="cm">/*</span></code>, the end of the comment by the same string. A block comment can cover text in part of a line, or can span multiple lines.</li>
<li><code class="codehilite">Rem</code> or <code class="codehilite">@</code>. For Oracle, a line starting with either REM or @ is a comment line.</li>
</ul>
<h2 id="avanced-aggregates">Avanced Aggregates<a class="headerlink" href="#avanced-aggregates" title="Permanent link">&para;</a></h2>
<p>At the heart of every great business decision is data. Since most businesses store critical data in SQL databases, a deep understanding of SQL is a necessary skill for every data analyst.</p>
<p>Chief among data analysis tasks is data aggregation, the grouping of data to express in summary form. We&rsquo;ll be working with SpeedySpoon, a meal delivery app. The folks at SpeedySpoon have asked us to look into their deliveries and help them optimize their process.</p>
<p>This course was developed in partnership with our good friends at Periscope Data. If you&rsquo;re new to SQL, we recommend you do this course first.</p>
<p>Complete each query by replacing the comments <code class="codehilite"><span class="cm">/**/</span><span class="w"></span></code> with SQL code.</p>
<p>We&rsquo;ll start by looking at SpeedySpoon&rsquo;s data. The orders table has a row for each order of a SpeedySpoon delivery. It says when the order took place, and who ordered it.</p>
<p>Add code to the select statement to select all columns in the orders table.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">select</span> <span class="o">*</span>
<span class="k">from</span> <span class="cm">/**/</span>
<span class="k">order</span> <span class="k">by</span> <span class="n">id</span>
<span class="k">limit</span> <span class="mi">100</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Note that the order and limit clauses keep the data organized.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">orders</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">id</span> <span class="k">LIMIT</span> <span class="mi">100</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>The order_items table lists the individual foods and their prices in each order. Complete the query to select all columns in the order_items table.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">order_items</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">id</span> <span class="k">LIMIT</span> <span class="mi">100</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Now that we have a good handle on our data, let&rsquo;s dive into some common business queries. We&rsquo;ll begin with the Daily Count of orders placed. To make our Daily Count metric, we&rsquo;ll focus on the date function and the ordered_at field.</p>
<p>To get the Daily Metrics we need the date. Most dates in databases are timestamps, which have hours and minutes, as well as the year, month, and day. Timestamps look like <code class="codehilite">2015-01-05 14:43:31</code>, while dates are the first part: <code class="codehilite">2015-01-05</code>.</p>
<p>We can easily select the date an item was ordered at with the date function and the ordered_at field:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="nb">date</span><span class="p">(</span><span class="n">ordered_at</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">orders</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Let&rsquo;s get a Daily Count of orders from the orders table. Complete the query using the date function to cast the timestamps in ordered_at to dates.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="err">​</span><span class="k">SELECT</span> <span class="nb">date</span><span class="p">(</span><span class="n">ordered_at</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">orders</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="mi">1</span>
<span class="k">LIMIT</span> <span class="mi">100</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>The order by 1 statement is a shortcut for order by date(ordered_at). The 1 refers to the first column.</p>
<p>Now that we can convert timestamps to dates, we can count the Orders Per Date. Generally, when we count all records in a table we run a query with the count function, as follows:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="k">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">users</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>This will treat all rows as a single group, and return one row in the result set - the total count.</p>
<p>To count orders by their dates, we&rsquo;ll use the date and count functions and pair them with the group by clause. Together this will count the records in the table, grouped by date.</p>
<p>For example, to see the user records counted by the date created, we use the date and count functions and group by clause as follows:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="nb">date</span><span class="p">(</span><span class="n">created_at</span><span class="p">),</span> <span class="k">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">users</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="nb">date</span><span class="p">(</span><span class="n">created_at</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Use the date and count functions and group by clause to count and group the orders by the dates they were ordered_at.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="nb">date</span><span class="p">(</span><span class="n">ordered_at</span><span class="p">),</span> <span class="k">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">orders</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Group before ordering</p>
<p>We have the Daily Count of orders, but what we really want to know is revenue. How much money has SpeedySpoon made from orders each day?</p>
<p>We can make a few changes to our Daily Count query to get the revenue.</p>
<p>First, instead of using count(1) to count the rows per date, we&rsquo;ll use round(sum(amount_paid), 2) to add up the revenue per date. Complete the query by adding revenue per date.</p>
<p>Second, we need to join in the order_items table because that table has an amount_paid column representing revenue. Complete the query by adding a join clause where orders.id = order_items.order_id.</p>
<p>Note that the round function rounds decimals to digits, based on the number passed in. Here round(&hellip;, 2) rounds the sum paid to two digits.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="nb">date</span><span class="p">(</span><span class="n">ordered_at</span><span class="p">),</span> <span class="n">round</span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="n">amount_paid</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">orders</span> <span class="k">JOIN</span> <span class="n">order_items</span> <span class="k">ON</span> 
    <span class="n">orders</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">order_items</span><span class="p">.</span><span class="n">order_id</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Now with a small change, we can find out how much we&rsquo;re making per day for any single dish. What&rsquo;s the daily revenue from customers ordering kale smoothies? Complete the query by using a where clause to filter the daily sums down to orders where the name = &lsquo;kale-smoothie&rsquo;.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="nb">date</span><span class="p">(</span><span class="n">ordered_at</span><span class="p">),</span> <span class="n">round</span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="n">amount_paid</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">orders</span> <span class="k">JOIN</span> <span class="n">order_items</span> <span class="k">ON</span> 
    <span class="n">orders</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">order_items</span><span class="p">.</span><span class="n">order_id</span>
<span class="k">WHERE</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;kale-smoothie&#39;</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>It looks like the smoothies might not be performing well, but to be sure we need to see how they&rsquo;re doing in the context of the other order items. We&rsquo;ll look at the data several different ways, the first of which is determining what percent of revenue these smoothies represent.</p>
<p>To get the percent of revenue that each item represents, we need to know the total revenue of each item. We will later divide the per-item total with the overall total revenue.</p>
<p>The following query groups and sum the products by price to get the total revenue for each item. Complete the query by passing in sum(amount_paid) into the round function and rounding to two decimal places.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">name</span><span class="p">,</span> <span class="n">round</span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="n">amount_paid</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">order_items</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">name</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="mi">2</span> <span class="k">DESC</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>We have the sum of the the products by revenue, but we still need the percent. For that, we&rsquo;ll need to get the total using a subquery. A subquery can perform complicated calculations and create filtered or aggregate tables on the fly.</p>
<p>Subqueries are useful when you want to perform an aggregation outside the context of the current query. This will let us calculate the overall total and per-item total at the same time.</p>
<p>Complete the denominator in the subquery, which is the total revenue from order_items. Use the sum function to query the amount_paid from the order_items table.</p>
<p>We now have the percent or revenue each product represents!</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">name</span><span class="p">,</span> <span class="n">round</span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="n">amount_paid</span><span class="p">)</span> <span class="o">/</span> 
    <span class="p">(</span><span class="k">SELECT</span> <span class="k">sum</span><span class="p">(</span><span class="n">amount_paid</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">order_items</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">order_items</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="mi">2</span> <span class="k">DESC</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Here order by 2 desc sorts by the second column (the percent) to show the products in order of their contribution to revenue.</p>
<p>As we suspected, kale smoothies are not bringing in the money. And thanks to this analysis, we found what might be a trend - several of the other low performing products are also smoothies. Let&rsquo;s keep digging to find out what&rsquo;s going on with these smoothies.</p>
<p>To see if our smoothie suspicion has merit, let&rsquo;s look at purchases by category. We can group the order items by what type of food they are, and go from there. Since our order_items table does not include categories already, we&rsquo;ll need to make some!</p>
<p>Previously we&rsquo;ve been using group by with a column (like order_items.name) or a function (like date(orders.ordered_at)).</p>
<p>We can also use group by with expressions. In this case a case statement is just what we need to build our own categories. case statements are similar to if/else in other languages. Here&rsquo;s the basic structure of a case statement:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">CASE</span> <span class="err">{</span><span class="n">condition</span><span class="err">}</span>
    <span class="k">WHEN</span> <span class="err">{</span><span class="n">value1</span><span class="err">}</span> <span class="k">THEN</span> <span class="err">{</span><span class="n">result1</span><span class="err">}</span>
    <span class="k">WHEN</span> <span class="err">{</span><span class="n">value2</span><span class="err">}</span> <span class="k">THEN</span> <span class="err">{</span><span class="n">result2</span><span class="err">}</span>
    <span class="k">ELSE</span> <span class="err">{</span><span class="n">result3</span><span class="err">}</span>
<span class="k">END</span>
</pre></div>
</td></tr></table>

<p>We&rsquo;ll build our own categories using a case statement. Complete the query below with a case condition of name that lists out each product, and decides its group.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span><span class="p">,</span>
    <span class="k">CASE</span> <span class="n">name</span>
        <span class="k">WHEN</span> <span class="s1">&#39;kale-smoothie&#39;</span>    <span class="k">THEN</span> <span class="s1">&#39;smoothie&#39;</span>
        <span class="k">WHEN</span> <span class="s1">&#39;banana-smoothie&#39;</span>  <span class="k">THEN</span> <span class="s1">&#39;smoothie&#39;</span>
        <span class="k">WHEN</span> <span class="s1">&#39;orange-juice&#39;</span>     <span class="k">THEN</span> <span class="s1">&#39;drink&#39;</span>
        <span class="k">WHEN</span> <span class="s1">&#39;soda&#39;</span>             <span class="k">THEN</span> <span class="s1">&#39;drink&#39;</span>
        <span class="k">WHEN</span> <span class="s1">&#39;blt&#39;</span>              <span class="k">THEN</span> <span class="s1">&#39;sandwich&#39;</span>
        <span class="k">WHEN</span> <span class="s1">&#39;grilled-cheese&#39;</span>   <span class="k">THEN</span> <span class="s1">&#39;sandwich&#39;</span>
        <span class="k">WHEN</span> <span class="s1">&#39;tikka-masala&#39;</span>     <span class="k">THEN</span> <span class="s1">&#39;dinner&#39;</span>
        <span class="k">WHEN</span> <span class="s1">&#39;chicken-parm&#39;</span>     <span class="k">THEN</span> <span class="s1">&#39;dinner&#39;</span>
        <span class="k">ELSE</span> <span class="s1">&#39;other&#39;</span>
    <span class="k">END</span> <span class="k">AS</span> <span class="n">category</span>
<span class="k">FROM</span> <span class="n">order_items</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">id</span>
<span class="k">LIMIT</span> <span class="mi">100</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Complete the query by using the category column created by the case statement in our previous revenue percent calculation. Add the denominator that will sum the amount_paid.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span>
    <span class="k">CASE</span> <span class="n">name</span>
        <span class="k">WHEN</span> <span class="s1">&#39;kale-smoothie&#39;</span>    <span class="k">THEN</span> <span class="s1">&#39;smoothie&#39;</span>
        <span class="k">WHEN</span> <span class="s1">&#39;banana-smoothie&#39;</span>  <span class="k">THEN</span> <span class="s1">&#39;smoothie&#39;</span>
        <span class="k">WHEN</span> <span class="s1">&#39;orange-juice&#39;</span>     <span class="k">THEN</span> <span class="s1">&#39;drink&#39;</span>
        <span class="k">WHEN</span> <span class="s1">&#39;soda&#39;</span>             <span class="k">THEN</span> <span class="s1">&#39;drink&#39;</span>
        <span class="k">WHEN</span> <span class="s1">&#39;blt&#39;</span>              <span class="k">THEN</span> <span class="s1">&#39;sandwich&#39;</span>
        <span class="k">WHEN</span> <span class="s1">&#39;grilled-cheese&#39;</span>   <span class="k">THEN</span> <span class="s1">&#39;sandwich&#39;</span>
        <span class="k">WHEN</span> <span class="s1">&#39;tikka-masala&#39;</span>     <span class="k">THEN</span> <span class="s1">&#39;dinner&#39;</span>
        <span class="k">WHEN</span> <span class="s1">&#39;chicken-parm&#39;</span>     <span class="k">THEN</span> <span class="s1">&#39;dinner&#39;</span>
        <span class="k">ELSE</span> <span class="s1">&#39;other&#39;</span>
    <span class="k">END</span> <span class="k">AS</span> <span class="n">category</span><span class="p">,</span> <span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span> <span class="o">*</span> <span class="k">sum</span><span class="p">(</span><span class="n">amount_paid</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="k">SELECT</span> <span class="k">sum</span><span class="p">(</span><span class="n">amount_paid</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">order_items</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">AS</span> <span class="n">pct</span>
<span class="k">FROM</span> <span class="n">order_items</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="mi">2</span> <span class="k">DESC</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Here 1.0 * is a shortcut to ensure the database represents the percent as a decimal.</p>
<p>It&rsquo;s true that the whole smoothie category is performing poorly compared to the others. We&rsquo;ll certainly take this discovery to SpeedySpoon. Before we do, let&rsquo;s go one level deeper and figure out why.</p>
<p>While we do know that kale smoothies (and drinks overall) are not driving a lot of revenue, we don&rsquo;t know why. A big part of data analysis is implementing your own metrics to get information out of the piles of data in your database.</p>
<p>In our case, the reason could be that no one likes kale, but it could be something else entirely. To find out, we&rsquo;ll create a metric called reorder rate and see how that compares to the other products at SpeedySpoon.</p>
<p>We&rsquo;ll define reorder rate as the ratio of the total number of orders to the number of people making those orders. A lower ratio means most of the orders are reorders. A higher ratio means more of the orders are first purchases.</p>
<p>Let&rsquo;s calculate the reorder ratio for all of SpeedySpoon&rsquo;s products and take a look at the results. Counting the total orders per product is straightforward. We count the distinct order_ids (different) in the order_items table.</p>
<p>Complete the query by passing in the distinct keyword and the order_id column name into the count function</p>
<p>Here&rsquo;s a hint on how to use the count function to count distinct columns in a table.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="k">column_name</span> <span class="k">FROM</span> <span class="k">table_name</span><span class="p">;</span>
<span class="k">SELECT</span> <span class="k">column_name</span> <span class="k">FROM</span> <span class="k">table_name</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="k">column_name</span><span class="p">;</span>

<span class="k">SELECT</span> <span class="n">name</span><span class="p">,</span> <span class="k">count</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">order_id</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">order_items</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Now we need the number of people making these orders.</p>
<p>To get that information, we need to join in the orders table and count unique values in the delivered_to field, and sort by the reorder_rate.</p>
<p>Complete the query below. The numerator should count the distinct order_ids. The denominator should count the distinct values of the orders table&rsquo;s delivered_to field (orders.delivered_to).</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">name</span><span class="p">,</span> <span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span> <span class="o">*</span> 
<span class="k">count</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">order_id</span><span class="p">)</span> <span class="o">/</span>
    <span class="k">count</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">delivered_to</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">AS</span> <span class="n">reorder_rate</span>
<span class="k">FROM</span> <span class="n">order_items</span>
    <span class="k">JOIN</span> <span class="n">orders</span> <span class="k">ON</span>
        <span class="n">orders</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">order_items</span><span class="p">.</span><span class="n">order_id</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="mi">2</span> <span class="k">DESC</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>That&rsquo;s unexpected. While smoothies aren&rsquo;t making a lot of money for SpeedySpoon, they have a very high reorder rate. That means these smoothie customers are strong repeat customers.</p>
<p>Instead of recommending smoothies be taken off the menu, we should talk to the smoothie customers and see what they like so much about these smoothies. There could be an opportunity here to expand the product line, or get other customers as excited as these kale fanatics. Nice work!</p>
<p>Let&rsquo;s generalize what we&rsquo;ve learned so far:</p>
<ul>
<li>
<p>Data aggregation is the grouping of data in summary form.</p>
</li>
<li>
<p>Daily Count is the count of orders in a day.</p>
</li>
<li>
<p>Daily Revenue Count is the revenue on orders per day.</p>
</li>
<li>
<p>Product Sum is the total revenue of a product.</p>
</li>
<li>
<p>Subqueries can be used to perform complicated calculations and create filtered or aggregate tables on the fly.</p>
</li>
<li>
<p>Reorder Rate is the ratio of the total number of orders to the number of people making orders.</p>
</li>
</ul>
<h2 id="common-metrics">Common Metrics<a class="headerlink" href="#common-metrics" title="Permanent link">&para;</a></h2>
<p>As a data scientist, when you&rsquo;re not investigating spikes or dips in your data, you might be building dashboards of KPIs, or key performance indicators for a company.</p>
<p>KPIs are often displayed on TVs on the walls of the office, and serve as high level health metrics for the business. While every company&rsquo;s metrics are defined slightly differently, the basics are usually very similar.</p>
<p>In this lesson we&rsquo;ll take a look at basic KPIs like Daily Revenue, Daily Active Users, ARPU, and Retention for a video game, Mineblocks.</p>
<p>This company has two tables, gameplays and purchases. The purchases table lists all purchases made by players while they&rsquo;re playing Mineblocks. Complete the query to select from purchases.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">purchases</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">id</span> <span class="k">LIMIT</span> <span class="mi">10</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>The gameplays table lists the date and platform for each session a user plays. Select from gameplays.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">gameplays</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">id</span> <span class="k">LIMIT</span> <span class="mi">10</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>At the heart of every company is revenue, and Mineblocks is no exception. For our first KPI we&rsquo;ll calculate daily revenue.</p>
<p>Daily Revenue is simply the sum of money made per day.</p>
<p>To get close to Daily Revenue, we calculate the daily sum of the prices in the purchases table. Complete the query by using the sum function and passing the price column from the purchases table. </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> 
    <span class="nb">date</span><span class="p">(</span><span class="n">created_at</span><span class="p">),</span>
    <span class="n">round</span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="n">price</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">purchases</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Update our daily revenue query to exclude refunds. Complete the query by filtering for refunded_at is not null. Update our daily revenue query to exclude refunds. Complete the query by filtering for refunded_at is not null.</p>
<p>Mineblocks is a game, and one of the core metrics to any game is the number people who play each day. That KPI is called Daily Active Users, or DAU.</p>
<p>DAU is defined as the number of unique players seen in-game each day. It&rsquo;s important not to double count users who played multiple times, so we&rsquo;ll use distinct in our count function.</p>
<p>Likewise, Weekly Active Users (WAU) and Monthly Active Users (MAU) are in the same family.</p>
<p>For Mineblocks, we&rsquo;ll use the gameplays table to calculate DAU. Each time a user plays the game, their session is recorded in gameplays. Thus, a distinct count of users per day from gameplays will give us DAU.</p>
<p>Calculate Daily Active Users for Mineblocks. Complete the query&rsquo;s count function by passing in the distinct keyword and the user_id column name.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span>
    <span class="nb">date</span><span class="p">(</span><span class="n">created_at</span><span class="p">),</span> 
    <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">user_id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">dau</span>
<span class="k">FROM</span> <span class="n">gameplays</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Since Mineblocks is on multiple platforms, we can calculate DAU per-platform.</p>
<p>Previously we calculated DAU only per day, so the output we wanted was [date, dau_count]. Now we want DAU per platform, making the desired output [date, platform, dau_count].</p>
<p>Calculate DAU for Mineblocks per-platform. Complete the query below. You will need to select the platform column and add a count function by passing in the distinct keyword and the user_id column name.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span>
    <span class="nb">date</span><span class="p">(</span><span class="n">created_at</span><span class="p">),</span> 
    <span class="n">platform</span><span class="p">,</span>
    <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">user_id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">dau</span>
<span class="k">FROM</span> <span class="n">gameplays</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>group by 1 (date), 2 (platform)<br />
 order by 1 (date), 2 (platform)</p>
<p>We&rsquo;ve looked at DAU and Daily Revenue in Mineblocks. Now we must understand the purchasing habits of our users.</p>
<p>Mineblocks, like every freemium game, has two types of users:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">purchasers</span><span class="o">:</span> <span class="n">users</span> <span class="n">who</span> <span class="n">have</span> <span class="n">bought</span> <span class="n">things</span> <span class="k">in</span> <span class="n">the</span> <span class="n">game</span>
<span class="n">players</span><span class="o">:</span> <span class="n">users</span> <span class="n">who</span> <span class="n">play</span> <span class="n">the</span> <span class="n">game</span> <span class="n">but</span> <span class="n">have</span> <span class="n">not</span> <span class="n">yet</span> <span class="n">purchased</span>
</pre></div>
</td></tr></table>

<p>The next KPI we&rsquo;ll look at Daily ARPPU - Average Revenue Per Purchasing User. This metric shows if the average amount of money spent by purchasers is going up over time.</p>
<p>Daily ARPPU is defined as the sum of revenue divided by the number of purchasers per day.</p>
<p>To get Daily ARPPU, modify the daily revenue query from earlier to divide by the number of purchasers.</p>
<p>Complete the query by adding a numerator and a denominator. The numerator will display daily revenue, or sum the price columns. The denominator will display the number of purchasers by passing the distinct keyword and the user_id column name into the count function.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span>
    <span class="nb">date</span><span class="p">(</span><span class="n">created_at</span><span class="p">),</span> 
    <span class="n">round</span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="o">/</span> <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">user_id</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">AS</span> <span class="n">arppu</span>
<span class="k">FROM</span> <span class="n">purchases</span>
<span class="k">WHERE</span> <span class="n">refunded_at</span> <span class="k">IS</span> <span class="k">NULL</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>The more popular (and difficult) cousin to Daily ARPPU is Daily ARPU, Average Revenue Per User. ARPU measures the average amount of money we&rsquo;re getting across all players, whether or not they&rsquo;ve purchased.</p>
<p>ARPPU increases if purchasers are spending more money. ARPU increases if more players are choosing to purchase, even if the purchase size stays consistent.</p>
<p>No one metric can tell the whole story. That&rsquo;s why it&rsquo;s so helpful to have many KPIs on the same dashboard.</p>
<p>Daily ARPU is defined as revenue divided by the number of players, per-day. To get that, we&rsquo;ll need to calculate the daily revenue and daily active users separately, and then join them on their dates.</p>
<p>One way to easily create and organize temporary results in a query is with CTEs, Common Table Expressions, also known as with clauses. The with clauses make it easy to define and use results in a more organized way than subqueries. These clauses usually look like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">WITH</span> <span class="err">{</span><span class="n">subquery_name</span><span class="err">}</span> <span class="k">AS</span> <span class="p">(</span>
    <span class="err">{</span><span class="n">subquery_body</span><span class="err">}</span>
<span class="p">)</span>
<span class="k">SELECT</span> <span class="p">...</span>
<span class="k">FROM</span> <span class="err">{</span><span class="n">subquery_name</span><span class="err">}</span>
<span class="k">WHERE</span> <span class="p">...</span>
</pre></div>
</td></tr></table>

<p>Use a with clause to define daily_revenue and then select from it.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">daily_revenue</span> <span class="k">AS</span> <span class="p">(</span>
    <span class="k">SELECT</span>
        <span class="nb">date</span><span class="p">(</span><span class="n">created_at</span><span class="p">)</span> <span class="k">AS</span> <span class="n">dt</span><span class="p">,</span>
        <span class="n">round</span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="n">price</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">AS</span> <span class="n">rev</span>
    <span class="k">FROM</span> <span class="n">purchases</span>
    <span class="k">WHERE</span> <span class="n">refunded_at</span> <span class="k">IS</span> <span class="k">NULL</span>
    <span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span>
<span class="p">)</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">daily_revenue</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">dt</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Use a with clause to define daily_revenue and then select from it.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">WITH</span> <span class="n">daily_revenue</span> <span class="k">AS</span> <span class="p">(</span>
    <span class="k">SELECT</span>
        <span class="nb">date</span><span class="p">(</span><span class="n">created_at</span><span class="p">)</span> <span class="k">AS</span> <span class="n">dt</span><span class="p">,</span>
        <span class="n">round</span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="n">price</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">AS</span> <span class="n">rev</span>
    <span class="k">FROM</span> <span class="n">purchases</span>
    <span class="k">WHERE</span> <span class="n">refunded_at</span> <span class="k">IS</span> <span class="k">NULL</span>
    <span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span>
<span class="p">)</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">daily_revenue</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">dt</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Now you&rsquo;re familiar with using the with clause to create temporary result sets.</p>
<p>You just built the first part of ARPU, daily_revenue. From here we can build the second half of ARPU in our with clause, daily_players, and use both together to create ARPU.</p>
<p>Building on this CTE, we can add in DAU from earlier. Complete the query by calling the DAU query we created earlier, now aliased as daily_players:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">WITH</span> <span class="n">daily_revenue</span> <span class="k">AS</span> <span class="p">(</span>
    <span class="k">SELECT</span>
        <span class="nb">date</span><span class="p">(</span><span class="n">created_at</span><span class="p">)</span> <span class="k">AS</span> <span class="n">dt</span><span class="p">,</span>
        <span class="n">round</span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="n">price</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">AS</span> <span class="n">rev</span>
    <span class="k">FROM</span> <span class="n">purchases</span>
    <span class="k">WHERE</span> <span class="n">refunded_at</span> <span class="k">IS</span> <span class="k">NULL</span>
    <span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span>
<span class="p">),</span>
<span class="n">daily_players</span> <span class="k">AS</span> <span class="p">(</span>
    <span class="k">SELECT</span>
        <span class="nb">date</span><span class="p">(</span><span class="n">created_at</span><span class="p">)</span> <span class="k">AS</span> <span class="n">dt</span><span class="p">,</span>
        <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">user_id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">players</span>
    <span class="k">FROM</span> <span class="n">gameplays</span>
    <span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span>
<span class="p">)</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">daily_players</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">dt</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Now that we have the revenue and DAU, join them on their dates and calculate daily ARPU. Complete the query by adding the keyword using in the join clause.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">WITH</span> <span class="n">daily_revenue</span> <span class="k">AS</span> <span class="p">(</span>
    <span class="k">SELECT</span>
        <span class="nb">date</span><span class="p">(</span><span class="n">created_at</span><span class="p">)</span> <span class="k">AS</span> <span class="n">dt</span><span class="p">,</span>
        <span class="n">round</span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="n">price</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">AS</span> <span class="n">rev</span>
    <span class="k">FROM</span> <span class="n">purchases</span>
    <span class="k">WHERE</span> <span class="n">refunded_at</span> <span class="k">IS</span> <span class="k">NULL</span>
    <span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span>
<span class="p">),</span>
<span class="n">daily_players</span> <span class="k">AS</span> <span class="p">(</span>
    <span class="k">SELECT</span>
        <span class="nb">date</span><span class="p">(</span><span class="n">created_at</span><span class="p">)</span> <span class="k">AS</span> <span class="n">dt</span><span class="p">,</span>
        <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">user_id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">players</span>
    <span class="k">FROM</span> <span class="n">gameplays</span>
    <span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span>
<span class="p">)</span>
<span class="k">SELECT</span> 
    <span class="n">daily_revenue</span><span class="p">.</span><span class="n">dt</span><span class="p">,</span>
    <span class="n">daily_revenue</span><span class="p">.</span><span class="n">rev</span> <span class="o">/</span>
    <span class="n">daily_players</span><span class="p">.</span><span class="n">players</span>
<span class="k">FROM</span> <span class="n">daily_players</span>
<span class="k">JOIN</span> <span class="n">daily_players</span> <span class="k">USING</span> <span class="p">(</span><span class="n">dt</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>In the final select statement, daily_revenue.dt represents the date, while daily_revenue.rev / daily_players.players is the daily revenue divided by the number of players that day. In full, it represents how much the company is making per player, per day.</p>
<p>In our ARPU query, we used using instead of on in the join clause. This is a special case join.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">FROM</span> <span class="n">daily_revenue</span> <span class="k">JOIN</span> <span class="n">daily_players</span> <span class="k">USING</span> <span class="p">(</span><span class="n">dt</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>When the columns to join have the same name in both tables you can use USING instead of on. Our use of the using keyword is in this case equivalent to this clause:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">FROM</span> <span class="n">daily_revenue</span> <span class="k">JOIN</span> <span class="n">daily_players</span> <span class="k">ON</span> <span class="n">daily_revenue</span><span class="p">.</span><span class="n">dt</span> <span class="o">=</span> <span class="n">daily_players</span><span class="p">.</span><span class="n">dt</span><span class="p">;</span>

<span class="k">JOIN</span> <span class="n">daily_players</span> <span class="k">USING</span> <span class="p">(</span><span class="n">dt</span><span class="p">);</span>
<span class="k">JOIN</span> <span class="n">daily_players</span> <span class="k">ON</span> <span class="n">daily_revenue</span><span class="p">.</span><span class="n">dt</span> <span class="o">=</span> <span class="n">daily_players</span><span class="p">.</span><span class="n">dt</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Now let&rsquo;s find out what percent of Mineblock players are returning to play the next day. This KPI is called 1 Day Retention.</p>
<p>Retention can be defined many different ways, but we&rsquo;ll stick to the most basic definition. For all players on Day N, we&rsquo;ll consider them retained if they came back to play again on Day N+1.</p>
<p>This will let us track whether or not Mineblocks is getting &ldquo;stickier&rdquo; over time. The stickier our game, the more days players will spend in-game.</p>
<p>And more time in-game means more opportunities to monetize and grow our business.</p>
<p>Before we can calculate retention we need to get our data formatted in a way where we can determine if a user returned.</p>
<p>Currently the gameplays table is a list of when the user played, and it&rsquo;s not easy to see if any user came back.</p>
<p>By using a self-join, we can make multiple gameplays available on the same row of results. This will enable us to calculate retention.</p>
<p>The power of self-join comes from joining every row to every other row. This makes it possible to compare values from two different rows in the new result set. In our case, we&rsquo;ll compare rows that are one date apart from each user.</p>
<p>To calculate retention, start from a query that selects the date(created_at) as dt and user_id columns from the gameplays table.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span>
    <span class="nb">date</span><span class="p">(</span><span class="n">created_at</span><span class="p">)</span> <span class="k">AS</span> <span class="n">dt</span><span class="p">,</span>
    <span class="n">user_id</span>
<span class="k">FROM</span> <span class="n">gameplays</span> <span class="k">AS</span> <span class="n">g1</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">dt</span>
<span class="k">LIMIT</span> <span class="mi">100</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Now we&rsquo;ll join gameplays on itself so that we can have access to all gameplays for each player, for each of their gameplays.</p>
<p>This is known as a self-join and will let us connect the players on Day N to the players on Day N+1. In order to join a table to itself, it must be aliased so we can access each copy separately.</p>
<p>We aliased gameplays in the query above because in the next step, we need to join gameplays to itself so we can get a result selecting [date, user_id, user_id_if_retained].</p>
<p>Complete the query by using a join statement to join gameplays to itself on user_id using the aliases g1 and g2.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span>
    <span class="nb">date</span><span class="p">(</span><span class="n">g1</span><span class="p">.</span><span class="n">created_at</span><span class="p">)</span> <span class="k">as</span> <span class="n">dt</span><span class="p">,</span>
    <span class="n">g1</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">FROM</span> <span class="n">gameplays</span> <span class="k">AS</span> <span class="n">g1</span>
<span class="k">JOIN</span> <span class="n">gameplays</span> <span class="k">AS</span> <span class="n">g2</span> <span class="k">ON</span>
    <span class="n">g1</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">g2</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="mi">1</span>
<span class="k">LIMIT</span> <span class="mi">100</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>We don&rsquo;t use the using clause here because the join is about to get more complicated.</p>
<p>Now that we have our gameplays table joined to itself, we can start to calculate retention.</p>
<p>1 Day Retention is defined as the number of players who returned the next day divided by the number of original players, per day. Suppose 10 players played Mineblocks on Dec 10<sup>th</sup>. If 4 of them play on Dec 11<sup>th</sup>, the 1 day retention for Dec 10<sup>th</sup> is 40%.</p>
<p>The previous query joined all rows in gameplays against all other rows for each user, making a massive result set that we don&rsquo;t need.</p>
<p>We&rsquo;ll need to modify this query.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span>
  <span class="nb">date</span><span class="p">(</span><span class="n">g1</span><span class="p">.</span><span class="n">created_at</span><span class="p">)</span> <span class="k">AS</span> <span class="n">dt</span><span class="p">,</span>
  <span class="n">g1</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span>
  <span class="n">g2</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">FROM</span> <span class="n">gameplays</span> <span class="k">AS</span> <span class="n">g1</span>
  <span class="k">JOIN</span> <span class="n">gameplays</span> <span class="k">AS</span> <span class="n">g2</span> <span class="k">ON</span>
    <span class="n">g1</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">g2</span><span class="p">.</span><span class="n">user_id</span>
    <span class="k">AND</span> <span class="cm">/**/</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="mi">1</span>
<span class="k">LIMIT</span> <span class="mi">100</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Complete the query above such that the join clause includes a date join:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nb">date</span><span class="p">(</span><span class="n">g1</span><span class="p">.</span><span class="n">created_at</span><span class="p">)</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="n">g2</span><span class="p">.</span><span class="n">created_at</span><span class="p">,</span> <span class="s1">&#39;-1 day&#39;</span><span class="p">))</span>
</pre></div>
</td></tr></table>

<p>This means &ldquo;only join rows where the date in g1 is one less than the date in g2&rdquo;, which makes it possible to see if users have returned!</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span>
    <span class="nb">date</span><span class="p">(</span><span class="n">g1</span><span class="p">.</span><span class="n">created_at</span><span class="p">)</span> <span class="k">as</span> <span class="n">dt</span><span class="p">,</span>
    <span class="n">g1</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span>
    <span class="n">g2</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">FROM</span> <span class="n">gameplays</span> <span class="k">AS</span> <span class="n">g1</span>
<span class="k">JOIN</span> <span class="n">gameplays</span> <span class="k">AS</span> <span class="n">g2</span> <span class="k">ON</span>
    <span class="n">g1</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">g2</span><span class="p">.</span><span class="n">user_id</span>
    <span class="k">AND</span> <span class="nb">date</span><span class="p">(</span><span class="n">g1</span><span class="p">.</span><span class="n">created_at</span><span class="p">)</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="n">g2</span><span class="p">.</span><span class="n">created_at</span><span class="p">,</span> <span class="s1">&#39;-1 day&#39;</span><span class="p">))</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="mi">1</span>
<span class="k">LIMIT</span> <span class="mi">100</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>The query above won&rsquo;t return meaningful results because we&rsquo;re using an inner join. This type of join requires that the condition be met for all rows, effectively limiting our selection to only the users that have returned.</p>
<p>Instead, we want to use a left join, this way all rows in g1 are preserved, leaving nulls in the rows from g2 where users did not return to play the next day.</p>
<p>Change the join clause to use left join and count the distinct number of users from g1 and g2 per date.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span>
    <span class="nb">date</span><span class="p">(</span><span class="n">g1</span><span class="p">.</span><span class="n">created_at</span><span class="p">)</span> <span class="k">as</span> <span class="n">dt</span><span class="p">,</span>
    <span class="k">count</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">g1</span><span class="p">.</span><span class="n">user_id</span><span class="p">)</span> <span class="k">as</span> <span class="n">total_users</span><span class="p">,</span>
    <span class="k">count</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">g2</span><span class="p">.</span><span class="n">user_id</span><span class="p">)</span> <span class="k">as</span> <span class="n">retained_users</span>
<span class="k">FROM</span> <span class="n">gameplays</span> <span class="k">AS</span> <span class="n">g1</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">gameplays</span> <span class="k">AS</span> <span class="n">g2</span> <span class="k">ON</span>
    <span class="n">g1</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">g2</span><span class="p">.</span><span class="n">user_id</span>
    <span class="k">AND</span> <span class="nb">date</span><span class="p">(</span><span class="n">g1</span><span class="p">.</span><span class="n">created_at</span><span class="p">)</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="n">g2</span><span class="p">.</span><span class="n">created_at</span><span class="p">,</span> <span class="s1">&#39;-1 day&#39;</span><span class="p">))</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="mi">1</span>
<span class="k">LIMIT</span> <span class="mi">100</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Now that we have retained users as count(distinct g2.user_id) and total users as count(distinct g1.user_id), divide retained users by total users to calculate 1 day retention!</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span>
    <span class="nb">date</span><span class="p">(</span><span class="n">g1</span><span class="p">.</span><span class="n">created_at</span><span class="p">)</span> <span class="k">as</span> <span class="n">dt</span><span class="p">,</span>
    <span class="n">round</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="k">count</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">g2</span><span class="p">.</span><span class="n">user_id</span><span class="p">)</span> <span class="o">/</span> <span class="k">count</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">g1</span><span class="p">.</span><span class="n">user_id</span><span class="p">))</span> <span class="k">AS</span> <span class="n">retention</span>
<span class="k">FROM</span> <span class="n">gameplays</span> <span class="k">AS</span> <span class="n">g1</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">gameplays</span> <span class="k">AS</span> <span class="n">g2</span> <span class="k">ON</span>
    <span class="n">g1</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">g2</span><span class="p">.</span><span class="n">user_id</span>
    <span class="k">AND</span> <span class="nb">date</span><span class="p">(</span><span class="n">g1</span><span class="p">.</span><span class="n">created_at</span><span class="p">)</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="n">g2</span><span class="p">.</span><span class="n">created_at</span><span class="p">,</span> <span class="s1">&#39;-1 day&#39;</span><span class="p">))</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="mi">1</span>
<span class="k">LIMIT</span> <span class="mi">100</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>While every business has different metrics to track their success, most are based on revenue and usage.</p>
<p>The metrics in this lesson are merely a starting point, and from here you&rsquo;ll be able to create and customize metrics to track whatever is most important to your company.</p>
<p>And remember, data science is exploratory! The current set of metrics can always be improved and there&rsquo;s usually more to any spike or dip than what immediately meets the eye.</p>
<p>Let&rsquo;s generalize what we&rsquo;ve learned so far:</p>
<ul>
<li>Key Performance Indicators are high level health metrics for a business.</li>
<li>Daily Revenue is the sum of money made per day.</li>
<li>Daily Active Users are the number of unique users seen each day.</li>
<li>Daily Average Revenue Per Purchasing User (ARPPU) is the average amount of money spent by purchasers each day.</li>
<li>Daily Average Revenue Per User (ARPU) is the average amount of money across all users.</li>
<li>1 Day Retention is defined as the number of players from Day N who came back to play again on Day N+1.</li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../codecademy_learn_sql/" title="Codecademy, Learn SQL" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Codecademy, Learn SQL
              </span>
            </div>
          </a>
        
        
          <a href="../codecademy_sql_table_transformation/" title="Codecademy, SQL, Table Transformation" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Codecademy, SQL, Table Transformation
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.b41f3d20.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
    
      
        <script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-93008985-3","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(a){a.host!=document.location.host&&a.addEventListener("click",function(){var e=a.getAttribute("data-md-action")||"follow";ga("send","event","outbound",e,a.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
  </body>
</html>