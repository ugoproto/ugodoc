



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="A Data Science documentation website.">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.2.0">
    
    
      
        <title>Codecademy, SQL, Table Transformation - ugodoc</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.572ca0f0.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#546e7a">
      
    
    
      <script src="../assets/javascripts/modernizr.8c900955.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue-grey" data-md-color-accent="red">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#subqueries" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="ugodoc" class="md-header-nav__button md-logo">
          
            <i class="md-icon">layers</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                ugodoc
              </span>
              <span class="md-header-nav__topic">
                Codecademy, SQL, Table Transformation
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/ugoproto/ugodoc.git/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      ugoproto/ugodoc
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="ugodoc" class="md-nav__button md-logo">
      
        <i class="md-icon">layers</i>
      
    </a>
    ugodoc
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/ugoproto/ugodoc.git/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      ugoproto/ugodoc
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Vade Mecum
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Vade Mecum
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../charts/" title="Charts" class="md-nav__link">
      Charts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../digital_humanities/" title="Digital Humanities" class="md-nav__link">
      Digital Humanities
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../edition_cs/" title="Edition Cheat Sheets" class="md-nav__link">
      Edition Cheat Sheets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../infographies/" title="Infographies" class="md-nav__link">
      Infographies
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../latex_snippets/" title="LaTeX Snippets" class="md-nav__link">
      LaTeX Snippets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../resources_for_data_science/" title="Resources for Data Science" class="md-nav__link">
      Resources for Data Science
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../storytelling_with_data/" title="Storytelling with Data" class="md-nav__link">
      Storytelling with Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ten_stories_data/" title="Ten Kinds of Stories to Tell with Data" class="md-nav__link">
      Ten Kinds of Stories to Tell with Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dix_recits_donnees/" title="Dix trames de récits avec des données" class="md-nav__link">
      Dix trames de récits avec des données
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../visual_perception/" title="Visual Perception (visualisation)" class="md-nav__link">
      Visual Perception (visualisation)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      OS & CLI
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        OS & CLI
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../os_cs/" title="OS Cheat Sheets" class="md-nav__link">
      OS Cheat Sheets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../codecademy_learn_the_command_line_notes/" title="Codecademy, Learn the Command Line Notes" class="md-nav__link">
      Codecademy, Learn the Command Line Notes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../command_line_crash_course/" title="Command Line Crash Course" class="md-nav__link">
      Command Line Crash Course
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../command_shell_snippets/" title="Command Shell Snippets" class="md-nav__link">
      Command Shell Snippets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cli_regex_git/" title="CLI, regex, and Git" class="md-nav__link">
      CLI, regex, and Git
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../the_linux_command_line/" title="The Linux Command Line" class="md-nav__link">
      The Linux Command Line
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../usefull_shell_commands_for_data_science/" title="Useful Shell Commands for Data Science" class="md-nav__link">
      Useful Shell Commands for Data Science
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      SQL & NoSQL
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        SQL & NoSQL
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../sql_nosql_cs/" title="SQL-NoSQL Cheat Sheets" class="md-nav__link">
      SQL-NoSQL Cheat Sheets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../codecademy_learn_sql/" title="Codecademy, Learn SQL" class="md-nav__link">
      Codecademy, Learn SQL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../codecademy_sql_analyzing_business_metrics/" title="Codecademy, SQL, Analyzing Business Metrics" class="md-nav__link">
      Codecademy, SQL, Analyzing Business Metrics
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Codecademy, SQL, Table Transformation
      </label>
    
    <a href="./" title="Codecademy, SQL, Table Transformation" class="md-nav__link md-nav__link--active">
      Codecademy, SQL, Table Transformation
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#subqueries" title="Subqueries" class="md-nav__link">
    Subqueries
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#non-correlated-subqueries" title="Non-Correlated Subqueries" class="md-nav__link">
    Non-Correlated Subqueries
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#correlated-subqueries" title="Correlated Subqueries" class="md-nav__link">
    Correlated Subqueries
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-can-we-generalize-so-far" title="What can we generalize so far?" class="md-nav__link">
    What can we generalize so far?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#merging-tables-together" title="Merging Tables Together" class="md-nav__link">
    Merging Tables Together
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#union" title="UNION" class="md-nav__link">
    UNION
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#intersect" title="INTERSECT" class="md-nav__link">
    INTERSECT
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#except" title="EXCEPT" class="md-nav__link">
    EXCEPT
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-can-we-generalize-so-far_1" title="What can we generalize so far?" class="md-nav__link">
    What can we generalize so far?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conditional-aggregates" title="Conditional Aggregates" class="md-nav__link">
    Conditional Aggregates
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-can-we-generalize-so-far_2" title="What can we generalize so far?" class="md-nav__link">
    What can we generalize so far?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#date-number-and-string-functions" title="Date, Number, and String Functions" class="md-nav__link">
    Date, Number, and String Functions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-can-we-generalize-so-far_3" title="What can we generalize so far?" class="md-nav__link">
    What can we generalize so far?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../introduction_to_sql_joins/" title="Introduction to SQL JOINs" class="md-nav__link">
      Introduction to SQL JOINs
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Web
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Web
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../embedding/" title="Embedding HTML into HTML" class="md-nav__link">
      Embedding HTML into HTML
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../html_and_css/" title="HTML and CSS" class="md-nav__link">
      HTML and CSS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../responsive_html/" title="Responsive HTML" class="md-nav__link">
      Responsive HTML
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#subqueries" title="Subqueries" class="md-nav__link">
    Subqueries
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#non-correlated-subqueries" title="Non-Correlated Subqueries" class="md-nav__link">
    Non-Correlated Subqueries
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#correlated-subqueries" title="Correlated Subqueries" class="md-nav__link">
    Correlated Subqueries
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-can-we-generalize-so-far" title="What can we generalize so far?" class="md-nav__link">
    What can we generalize so far?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#merging-tables-together" title="Merging Tables Together" class="md-nav__link">
    Merging Tables Together
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#union" title="UNION" class="md-nav__link">
    UNION
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#intersect" title="INTERSECT" class="md-nav__link">
    INTERSECT
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#except" title="EXCEPT" class="md-nav__link">
    EXCEPT
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-can-we-generalize-so-far_1" title="What can we generalize so far?" class="md-nav__link">
    What can we generalize so far?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conditional-aggregates" title="Conditional Aggregates" class="md-nav__link">
    Conditional Aggregates
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-can-we-generalize-so-far_2" title="What can we generalize so far?" class="md-nav__link">
    What can we generalize so far?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#date-number-and-string-functions" title="Date, Number, and String Functions" class="md-nav__link">
    Date, Number, and String Functions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-can-we-generalize-so-far_3" title="What can we generalize so far?" class="md-nav__link">
    What can we generalize so far?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ugoproto/ugodoc.git/edit/master/docs/codecademy_sql_table_transformation.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Codecademy, SQL, Table Transformation</h1>
                
                <p><strong>Foreword</strong></p>
<p>Code snippets. From Codecademy.</p>
<hr />
<p>While working with databases, we often need to transform data from one format to achieve a desired result. In SQL, this is often called data transformation or table transformation.</p>
<h2 id="subqueries">Subqueries<a class="headerlink" href="#subqueries" title="Permanent link">&para;</a></h2>
<p>Subqueries, sometimes referred to as inner queries or nested queries, are used to transform table data by nesting one query within another query. </p>
<p>Two tables: <code class="codehilite">airports</code> and <code class="codehilite">flights</code>.</p>
<p>Select ten rows from the <code class="codehilite">flights</code> table.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">flights</span> <span class="k">LIMIT</span> <span class="mi">10</span><span class="p">;</span>
<span class="o">```</span><span class="k">sql</span>

<span class="n">We</span> <span class="k">first</span> <span class="k">create</span> <span class="n">an</span> <span class="k">inner</span> <span class="n">query</span><span class="p">,</span> <span class="k">or</span> <span class="n">subquery</span><span class="p">,</span> <span class="n">that</span> <span class="n">finds</span> <span class="n">the</span> <span class="n">airports</span> <span class="k">with</span> <span class="n">elevation</span> <span class="n">greater</span> <span class="k">than</span> <span class="mi">2000</span> <span class="k">from</span> <span class="n">the</span> <span class="o">`</span><span class="n">airports</span><span class="o">`</span> <span class="k">table</span><span class="p">.</span> 

<span class="o">```</span><span class="k">sql</span>
<span class="k">SELECT</span> <span class="n">code</span> <span class="k">FROM</span> <span class="n">airports</span> <span class="k">WHERE</span> <span class="n">elevation</span> <span class="o">&gt;</span> <span class="mi">2000</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Next, we take the result set of the inner query and use it to filter on the <code class="codehilite">flights</code> table, to find the flight detail that meets the elevation criteria.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">flights</span> <span class="k">WHERE</span> <span class="n">origin</span> <span class="k">in</span> <span class="p">(</span>
    <span class="k">SELECT</span> <span class="n">code</span> <span class="k">FROM</span> <span class="n">airports</span> <span class="k">WHERE</span> <span class="n">elevation</span> <span class="o">&gt;</span> <span class="mi">2000</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>Find flight information about <code class="codehilite">flights</code> where the origin elevation is less than 2000 feet.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">flights</span> <span class="k">WHERE</span> <span class="n">origin</span> <span class="k">in</span> <span class="p">(</span>
    <span class="k">SELECT</span> <span class="n">code</span> <span class="k">FROM</span> <span class="n">airports</span> <span class="k">WHERE</span> <span class="n">elevation</span> <span class="o">&lt;</span> <span class="mi">2000</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<h2 id="non-correlated-subqueries">Non-Correlated Subqueries<a class="headerlink" href="#non-correlated-subqueries" title="Permanent link">&para;</a></h2>
<p>A non-correlated subquery is a subquery that can be run independently of the outer query and as we saw, can be used to complete a multi-step transformation.</p>
<p>Perhaps we&rsquo;d like to look at a selection of <code class="codehilite">flights</code> whose origin airport is a seaplane base, designated by <code class="codehilite">&#39;SEAPLANE_BASE&#39;</code>. The facility type of an airport is located in the <code class="codehilite">fac_type</code> field of the <code class="codehilite">airports</code> table.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">flights</span> <span class="k">WHERE</span> <span class="n">origin</span> <span class="k">in</span> <span class="p">(</span>
    <span class="k">SELECT</span> <span class="n">code</span> <span class="k">FROM</span> <span class="n">airports</span> <span class="k">WHERE</span> <span class="n">fac_type</span> <span class="o">=</span> <span class="s1">&#39;SEAPLANE_BASE&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>Using the same pattern, find flight information about <code class="codehilite">flights</code> where the Federal Aviation Administration region (<code class="codehilite">faa_region</code>) is the Southern region (<code class="codehilite">&#39;ASO&#39;</code>).</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">flights</span> <span class="k">WHERE</span> <span class="n">origin</span> <span class="k">in</span> <span class="p">(</span>
    <span class="k">SELECT</span> <span class="n">code</span> <span class="k">FROM</span> <span class="n">airports</span> <span class="k">WHERE</span> <span class="n">faa_region</span> <span class="o">=</span> <span class="s1">&#39;ASO&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>Perform transformations on a single table. For instance, sometimes we need to aggregate in multiple steps &ndash; like taking an average of a count.</p>
<p>Imagine you’d like to know how many <code class="codehilite">flights</code> there are on average, for all Fridays in a given month from the <code class="codehilite">flights</code> table. First, we’d need to calculate the number of <code class="codehilite">flights</code> per day, and then we’d need to calculate the average based on the daily flight count for each day of the week. We can do this all in one step using a subquery:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">a</span><span class="p">.</span><span class="n">dep_month</span><span class="p">,</span>
       <span class="n">a</span><span class="p">.</span><span class="n">dep_day_of_week</span><span class="p">,</span>
       <span class="k">AVG</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">flight_count</span><span class="p">)</span> <span class="k">AS</span> <span class="n">average_</span><span class="o">`</span><span class="n">flights</span><span class="o">`</span>
    <span class="k">FROM</span> <span class="p">(</span>
        <span class="k">SELECT</span> <span class="n">dep_month</span><span class="p">,</span>
               <span class="n">dep_day_of_week</span><span class="p">,</span>
               <span class="n">dep_date</span><span class="p">,</span>
               <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">AS</span> <span class="n">flight_count</span>
        <span class="k">FROM</span> <span class="o">`</span><span class="n">flights</span><span class="o">`</span>
        <span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span>
        <span class="p">)</span> <span class="n">a</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>The inner query provides the count of flights by day, and the outer query uses the inner query’s result set to compute the average by day of week of a given month.</p>
<p>Using a subquery, find the average total distance flown by day of week and month. Be sure to alias the outer query as <code class="codehilite">average_distance</code> and the inner query as <code class="codehilite">flight_distance</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">a</span><span class="p">.</span><span class="n">dep_month</span><span class="p">,</span>
       <span class="n">a</span><span class="p">.</span><span class="n">dep_day_of_week</span><span class="p">,</span>
       <span class="k">AVG</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">flight_distance</span><span class="p">)</span> <span class="k">AS</span> <span class="n">average_distance</span>
    <span class="k">FROM</span> <span class="p">(</span>
        <span class="k">SELECT</span> <span class="n">dep_month</span><span class="p">,</span>
              <span class="n">dep_day_of_week</span><span class="p">,</span>
               <span class="n">dep_date</span><span class="p">,</span>
               <span class="k">sum</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span> <span class="k">AS</span> <span class="n">flight_distance</span>
        <span class="k">FROM</span> <span class="o">`</span><span class="n">flights</span><span class="o">`</span>
        <span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span>
    <span class="p">)</span> <span class="n">a</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<h2 id="correlated-subqueries">Correlated Subqueries<a class="headerlink" href="#correlated-subqueries" title="Permanent link">&para;</a></h2>
<p>In a correlated subquery, the subquery can not be run independently of the outer query. The order of operations is important in a correlated subquery:</p>
<p>A row is processed in the outer query. Then, for that particular row in the outer query, the subquery is executed.</p>
<p>This means that for each row processed by the outer query, the subquery will also be processed for that row. In this example, we will find the list of all flights whose distance is above average for their carrier (query on a query, same table).</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">id</span>
<span class="k">FROM</span> <span class="o">`</span><span class="n">flights</span><span class="o">`</span> <span class="k">AS</span> <span class="n">f</span>
<span class="k">WHERE</span> <span class="n">distance</span> <span class="o">&gt;</span> <span class="p">(</span>
    <span class="k">SELECT</span> <span class="k">AVG</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span>
    <span class="k">FROM</span> <span class="o">`</span><span class="n">flights</span><span class="o">`</span>
    <span class="k">WHERE</span> <span class="n">carrier</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">carrier</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>In the above query the inner query has to be re-executed for each flight. Correlated subqueries may appear elsewhere besides the <code class="codehilite">WHERE</code> clause, they can also appear in the <code class="codehilite">SELECT</code>.</p>
<p>Find the id of the flights whose distance is below average for their carrier.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">id</span>
<span class="k">FROM</span> <span class="n">flights</span> <span class="k">AS</span> <span class="n">f</span>
<span class="k">WHERE</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="p">(</span>
    <span class="k">SELECT</span> <span class="k">AVG</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span>
    <span class="k">FROM</span> <span class="n">flights</span>
    <span class="k">WHERE</span> <span class="n">carrier</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">carrier</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>It would also be interesting to order flights by giving them a sequence number based on time, by carrier. For instance, assuming flight_id increments with each additional flight, we could use the following query to view flights by carrier, flight id, and sequence number:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">carrier</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span>
    <span class="p">(</span><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
        <span class="k">FROM</span> <span class="n">flights</span> <span class="n">f</span>
        <span class="k">WHERE</span> <span class="n">f</span><span class="p">.</span><span class="n">id</span> <span class="o">&lt;</span> <span class="n">flights</span><span class="p">.</span><span class="n">id</span>
        <span class="k">AND</span> <span class="n">f</span><span class="p">.</span><span class="n">carrier</span><span class="o">=</span><span class="n">flights</span><span class="p">.</span><span class="n">carrier</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> 
        <span class="k">AS</span> <span class="n">flight_sequence_number</span>
        <span class="k">FROM</span> <span class="n">flights</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Using the same pattern, write a query to view flights by origin, flight id, and sequence number. Alias the sequence number column as <code class="codehilite">flight_sequence_number</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">origin</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span>
    <span class="p">(</span><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
    <span class="k">FROM</span> <span class="n">flights</span> <span class="n">f</span>
    <span class="k">WHERE</span> <span class="n">f</span><span class="p">.</span><span class="n">id</span> <span class="o">&lt;</span> <span class="n">flights</span><span class="p">.</span><span class="n">id</span>
    <span class="k">AND</span> <span class="n">f</span><span class="p">.</span><span class="n">origin</span><span class="o">=</span><span class="n">flights</span><span class="p">.</span><span class="n">origin</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> 
    <span class="k">AS</span> <span class="n">flight_sequence_number</span>
    <span class="k">FROM</span> <span class="n">flights</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<h3 id="what-can-we-generalize-so-far">What can we generalize so far?<a class="headerlink" href="#what-can-we-generalize-so-far" title="Permanent link">&para;</a></h3>
<ul>
<li>Subqueries are used to complete an SQL transformation by nesting one query within another query.</li>
<li>A non-correlated subquery is a subquery that can be run independently of the outer query and can be used to complete a multi-step transformation.</li>
<li>A correlated subquery is a subquery that cannot be run independently of the outer query. The order of operations in a correlated subquery is as follows:<ol>
<li>A row is processed in the outer query.</li>
<li>Then, for that particular row in the outer query, the subquery is executed.</li>
<li>Set Operations.</li>
</ol>
</li>
</ul>
<p>Unions allow us to utilize information from multiple tables in our queries. In this lesson, we’ll utilize data from an e-commerce store. Let’s explore the available data we’ll be using. </p>
<p>Four tables: <code class="codehilite">new_products</code>, <code class="codehilite">legacy_products</code>, <code class="codehilite">order_items</code> and <code class="codehilite">order_items_historic</code>.</p>
<p>In our database, we have products tables that contain metadata about each product in the store. Select ten rows from the <code class="codehilite">new_products</code> table.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">new_products</span> <span class="k">LIMIT</span> <span class="mi">10</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<h2 id="merging-tables-together">Merging Tables Together<a class="headerlink" href="#merging-tables-together" title="Permanent link">&para;</a></h2>
<p>Sometimes, in order to answer certain questions based on data, we need to merge two tables together and then query the merged result. Perhaps we have two tables that contain information about products in an ecommerce store that we would like to combine. There are two ways of doing this:</p>
<ul>
<li>Merge the rows, called a <code class="codehilite">JOIN</code>.</li>
<li>Merge the columns, called a <code class="codehilite">UNION</code>.</li>
</ul>
<h3 id="union"><code class="codehilite">UNION</code><a class="headerlink" href="#union" title="Permanent link">&para;</a></h3>
<p>We&rsquo;ll focus on unions here. Union combines the result of two or more <code class="codehilite">SELECT</code> statements, using the following syntax:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">table1</span>
<span class="k">UNION</span>
<span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">table2</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Each <code class="codehilite">SELECT</code> statement within the <code class="codehilite">UNION</code> must have the same number of columns with similar data types. The columns in each <code class="codehilite">SELECT</code> statement must be in the same order. By default, the <code class="codehilite">UNION</code> operator selects only distinct values.</p>
<p>Suppose we are a growing ecommerce store and recently acquired another store to diversify our offering. The product data still exists in two separate tables: a <code class="codehilite">legacy_products</code> table and a <code class="codehilite">new_products</code> table. To get the complete list of product names from both tables, we can perform the following union.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">item_name</span> <span class="k">FROM</span> <span class="n">legacy_products</span>
<span class="k">UNION</span> 
<span class="k">SELECT</span> <span class="n">item_name</span> <span class="k">FROM</span> <span class="n">new_products</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Select a complete list of brand names from the <code class="codehilite">legacy_products</code> and <code class="codehilite">new_products</code> tables.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">brand</span> <span class="k">FROM</span> <span class="n">legacy_products</span>
<span class="k">UNION</span>
<span class="k">SELECT</span> <span class="n">brand</span> <span class="k">FROM</span> <span class="n">new_products</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>What if we wanted to allow duplicate values? We can do this by using the <code class="codehilite">ALL</code> keyword with <code class="codehilite">UNION</code>, with the following syntax:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">table1</span>
<span class="k">UNION</span> <span class="k">ALL</span>
<span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">table2</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>In our ecommerce store, if we learned that we had records from historic order items in an additional table, we could use the following query to combine the tables for a complete analysis of sale price:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span> <span class="n">sale_price</span> <span class="k">FROM</span> <span class="n">order_items</span>
<span class="k">UNION</span> <span class="k">ALL</span>
<span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span> <span class="n">sale_price</span> <span class="k">FROM</span> <span class="n">order_items_historic</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Then we can perform an analysis on top of the combined result set, like finding the total count of order items.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">FROM</span> <span class="p">(</span>
    <span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span> <span class="n">sale_price</span> <span class="k">FROM</span> <span class="n">order_items</span>
    <span class="k">UNION</span> <span class="k">ALL</span>
    <span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span> <span class="n">sale_price</span> <span class="k">FROM</span> <span class="n">order_items_historic</span><span class="p">)</span> <span class="k">as</span> <span class="n">a</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Using the same pattern, utilize a subquery to find the average sale price over both <code class="codehilite">order_items</code> and <code class="codehilite">order_items_historic</code> tables.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span> <span class="k">avg</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">sale_price</span><span class="p">)</span> <span class="k">FROM</span> <span class="p">(</span>
    <span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span> <span class="n">sale_price</span> <span class="k">FROM</span> <span class="n">order_items</span>
    <span class="k">UNION</span> <span class="k">ALL</span>
    <span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span> <span class="n">sale_price</span> <span class="k">FROM</span> <span class="n">order_items_historic</span><span class="p">)</span> <span class="k">AS</span> <span class="n">a</span> 
    <span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Before running the top analysis, create an alias a with the preliminary results, run the <code class="codehilite">avg(a.sale_price)</code>, and group by 1 to view separate records and not a unique aggregate record!!!</p>
<h3 id="intersect"><code class="codehilite">INTERSECT</code><a class="headerlink" href="#intersect" title="Permanent link">&para;</a></h3>
<p>&hellip;is used to combine two <code class="codehilite">SELECT</code> statements, but returns rows only from the first <code class="codehilite">SELECT</code> statement that are identical to a row in the second <code class="codehilite">SELECT</code> statement. This means that it returns only common rows returned by the two <code class="codehilite">SELECT</code> statements.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">table1</span>
<span class="k">INTERSECT</span>
<span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">table2</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>For instance, we might want to know what brands in our newly acquired store are also in our legacy store. We can do so using the following query:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">brand</span> <span class="k">FROM</span> <span class="n">new_products</span>
<span class="k">INTERSECT</span>
<span class="k">SELECT</span> <span class="n">brand</span> <span class="k">FROM</span> <span class="n">legacy_products</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Select the items in the category column that are both in the newly acquired <code class="codehilite">new_products</code> table and the <code class="codehilite">legacy_products</code> table.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">category</span> <span class="k">FROM</span> <span class="n">new_products</span>
<span class="k">INTERSECT</span>
<span class="k">SELECT</span> <span class="n">category</span> <span class="k">FROM</span> <span class="n">legacy_products</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<h3 id="except"><code class="codehilite">EXCEPT</code><a class="headerlink" href="#except" title="Permanent link">&para;</a></h3>
<p>&hellip;is constructed in the same way, but returns distinct rows from the first <code class="codehilite">SELECT</code> statement that aren’t output by the second <code class="codehilite">SELECT</code> statement.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">table1</span>
<span class="k">EXCEPT</span>
<span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">table2</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Suppose we want to see if there are any categories that are in the <code class="codehilite">new_products</code> table that aren&rsquo;t in the <code class="codehilite">legacy_products</code> table. We can use an <code class="codehilite">EXCEPT</code> query to perform this analysis:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">category</span> <span class="k">FROM</span> <span class="n">new_products</span>
<span class="k">EXCEPT</span>
<span class="k">SELECT</span> <span class="n">category</span> <span class="k">FROM</span> <span class="n">legacy_products</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Conversely, select the items in the category column that are in the <code class="codehilite">legacy_products</code> table and not in the <code class="codehilite">new_products</code> table.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">category</span> <span class="k">FROM</span> <span class="n">legacy_products</span>
<span class="k">EXCEPT</span>
<span class="k">SELECT</span> <span class="n">category</span> <span class="k">FROM</span> <span class="n">new_products</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<h3 id="what-can-we-generalize-so-far_1">What can we generalize so far?<a class="headerlink" href="#what-can-we-generalize-so-far_1" title="Permanent link">&para;</a></h3>
<ul>
<li>The <code class="codehilite">UNION</code> clause allows us to utilize information from multiple tables in our queries.</li>
<li>The <code class="codehilite">UNION ALL</code> clause allows us to utilize information from multiple tables in our queries, including duplicate values.</li>
<li><code class="codehilite">INTERSECT</code> is used to combine two <code class="codehilite">SELECT</code> statements, but returns rows only from the first <code class="codehilite">SELECT</code> statement that are identical to a row in the second <code class="codehilite">SELECT</code> statement.</li>
<li><code class="codehilite">EXCEPT</code> returns distinct rows from the first <code class="codehilite">SELECT</code> statement that aren’t output by the second <code class="codehilite">SELECT</code> statement</li>
</ul>
<h2 id="conditional-aggregates">Conditional Aggregates<a class="headerlink" href="#conditional-aggregates" title="Permanent link">&para;</a></h2>
<p>Aggregate functions compute a single result from a set of multiple input values. You can think of aggregate data as data collected from multiple rows at a time. In this lesson, we&rsquo;ll continue learning about aggregate functions by focusing on conditionals, sums, and combining aggregate functions.</p>
<p>Conditional Aggregates are aggregate functions that compute a result set based on a given set of conditions.</p>
<p>The count function is an aggregate function, since it aggregates data from multiple rows.</p>
<p>Count the number of rows in the <code class="codehilite">flights</code> table, representing the total number of <code class="codehilite">flights</code> contained in the table.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">flights</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>While working with databases, it&rsquo;s common to have empty or unknown &ldquo;cells&rdquo; in data tables.</p>
<p>What do we do when we need to test whether a value is or is not null? We use the special keywords <code class="codehilite">IS NULL</code> or <code class="codehilite">IS NOT NULL</code> in the <code class="codehilite">WHERE</code> clause (<code class="codehilite">= NULL</code> does not work).</p>
<p>Count the number of rows from the <code class="codehilite">flights</code> table, where <code class="codehilite">arr_time</code> is not null and the destination is <code class="codehilite">&#39;ATL&#39;</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">flights</span> <span class="k">WHERE</span> <span class="n">arr_time</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">AND</span> <span class="n">destination</span> <span class="o">=</span> <span class="s1">&#39;ATL&#39;</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Almost every programming language has a way to represent &ldquo;if, then, else&rdquo;, or conditional logic. In SQL, we represent this logic with the <code class="codehilite">CASE</code> statement, as follows:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span>
    <span class="k">CASE</span>
        <span class="k">WHEN</span> <span class="n">elevation</span> <span class="o">&lt;</span> <span class="mi">500</span> <span class="k">THEN</span> <span class="s1">&#39;Low&#39;</span>
        <span class="k">WHEN</span> <span class="n">elevation</span> <span class="k">BETWEEN</span> <span class="mi">500</span> <span class="k">AND</span> <span class="mi">1999</span> <span class="k">THEN</span> <span class="s1">&#39;Medium&#39;</span>
        <span class="k">WHEN</span> <span class="n">elevation</span> <span class="o">&gt;=</span> <span class="mi">2000</span> <span class="k">THEN</span> <span class="s1">&#39;High&#39;</span>
        <span class="k">ELSE</span> <span class="s1">&#39;Unknown&#39;</span>
    <span class="k">END</span> <span class="k">AS</span> <span class="n">elevation_tier</span><span class="p">,</span> 
    <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">airports</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>In the above statement, <code class="codehilite">END</code> is required to terminate the statement, but <code class="codehilite">ELSE</code> is optional. If <code class="codehilite">ELSE</code> is not included, the result will be <code class="codehilite">NULL</code>. Also notice the shorthand method of referencing columns to use in <code class="codehilite">GROUP BY</code>, so we don&rsquo;t have to rewrite the entire <code class="codehilite">CASE</code> Statement.</p>
<p>Modify the case statement&rsquo;s such that when the elevation is less than 250, the <code class="codehilite">elevation_tier</code> column returns <code class="codehilite">&#39;Low&#39;</code>, when between 250 and 1749 it returns <code class="codehilite">&#39;Medium&#39;</code>, and when greater than or equal to 1750 it returns <code class="codehilite">&#39;High&#39;</code>.</p>
<p>Be sure to alias the conditional statement as <code class="codehilite">elevation_tier</code>, in your query.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span>
    <span class="k">CASE</span>
        <span class="k">WHEN</span> <span class="n">elevation</span> <span class="o">&lt;</span> <span class="mi">250</span> <span class="k">THEN</span> <span class="s1">&#39;Low&#39;</span>
        <span class="k">WHEN</span> <span class="n">elevation</span> <span class="k">BETWEEN</span> <span class="mi">250</span> <span class="k">AND</span> <span class="mi">1749</span> <span class="k">THEN</span> <span class="s1">&#39;Medium&#39;</span>
        <span class="k">WHEN</span> <span class="n">elevation</span> <span class="o">&gt;=</span> <span class="mi">1750</span> <span class="k">THEN</span> <span class="s1">&#39;High&#39;</span>
        <span class="k">ELSE</span> <span class="s1">&#39;Unknown&#39;</span>
    <span class="k">END</span> <span class="k">AS</span> <span class="n">elevation_tier</span><span class="p">,</span> 
    <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">airports</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Sometimes you want to look at an entire result set, but want to implement conditions on certain aggregates.</p>
<p>For instance, maybe you want to identify the total amount of airports as well as the total amount of airports with high elevation in the same result set. We can accomplish this by putting a <code class="codehilite">CASE WHEN</code> statement in the aggregate.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="k">state</span><span class="p">,</span> 
    <span class="k">COUNT</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">elevation</span> <span class="o">&gt;=</span> <span class="mi">2000</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">ELSE</span> <span class="k">NULL</span> <span class="k">END</span><span class="p">)</span> <span class="k">as</span> <span class="n">count_high_elevation_aiports</span> 
<span class="k">FROM</span> <span class="n">airports</span> 
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">state</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Using the same pattern, write a query to count the number of low elevation airports by state where low elevation is defined as less than 1000 ft. Be sure to alias the counted airports as <code class="codehilite">count_low_elevation_airports</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="k">state</span><span class="p">,</span> 
    <span class="k">COUNT</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">elevation</span> <span class="o">&lt;</span> <span class="mi">1000</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">ELSE</span> <span class="k">NULL</span> <span class="k">END</span><span class="p">)</span> <span class="k">as</span> <span class="n">count_low_elevation_aiports</span> 
<span class="k">FROM</span> <span class="n">airports</span> 
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">state</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>We can do that same thing for other aggregates like <code class="codehilite">SUM()</code>. For instance, if we wanted to sum the total flight distance and compare that to the sum of flight distance from a particular airline (in this case, United Airlines) by origin airport, we could run the following query:<br />
<code class="codehilite">sum(distance)</code> for all carriers (<code class="codehilite">total_flight_distance</code>)<br />
<code class="codehilite">sum(distance)</code> for <code class="codehilite">&#39;UA&#39;</code> only (others are turned to 0) (<code class="codehilite">total_united_flight_distance</code>).</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">origin</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span> <span class="k">as</span> <span class="n">total_flight_distance</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">carrier</span> <span class="o">=</span> <span class="s1">&#39;UA&#39;</span> <span class="k">THEN</span> <span class="n">distance</span> <span class="k">ELSE</span> <span class="mi">0</span> <span class="k">END</span><span class="p">)</span> <span class="k">as</span> <span class="n">total_united_flight_distance</span> 
<span class="k">FROM</span> <span class="n">flights</span> 
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">origin</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Using the same pattern, find both the total flight distance as and flight distance by origin for Delta (<code class="codehilite">carrier = &#39;DL&#39;</code>).</p>
<p>Alias the flight distance as <code class="codehilite">total_flight_distance</code> and the and flight distance by origin as <code class="codehilite">total_delta_flight_distance</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">origin</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span> <span class="k">as</span> <span class="n">total_flight_distance</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">carrier</span> <span class="o">=</span> <span class="s1">&#39;DL&#39;</span> <span class="k">THEN</span> <span class="n">distance</span> <span class="k">ELSE</span> <span class="mi">0</span> <span class="k">END</span><span class="p">)</span> <span class="k">as</span> <span class="n">total_delta_flight_distance</span> 
<span class="k">FROM</span> <span class="n">flights</span> 
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">origin</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Using the same pattern, find the percentage of <code class="codehilite">flights</code> from Delta by origin (<code class="codehilite">carrier = &#39;DL&#39;</code>):</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">origin</span><span class="p">,</span> <span class="mi">100</span><span class="p">.</span><span class="mi">0</span><span class="o">*</span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">carrier</span> <span class="o">=</span> <span class="s1">&#39;DL&#39;</span> <span class="k">THEN</span> <span class="n">distance</span> <span class="k">ELSE</span> <span class="mi">0</span> <span class="k">END</span><span class="p">)</span><span class="o">/</span><span class="k">sum</span><span class="p">(</span><span class="n">distance</span><span class="p">))</span> <span class="k">as</span> <span class="n">percentage_flight_distance_from_delta</span> <span class="k">FROM</span> <span class="n">flights</span> 
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">origin</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Find the percentage of high elevation airports (<code class="codehilite">elevation &gt;= 2000</code>) by state from the <code class="codehilite">airports</code> table. In the query, alias the percentage column as <code class="codehilite">percentage_high_elevation_airports</code>.<br />
<code class="codehilite">(sum of &#39;1&#39;) / count(*)</code> and not <code class="codehilite">(count of &#39;1&#39;) / count(*)</code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="k">state</span><span class="p">,</span> <span class="mi">100</span><span class="p">.</span><span class="mi">0</span> <span class="o">*</span> <span class="k">sum</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">elevation</span> <span class="o">&gt;=</span> <span class="mi">2000</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">ELSE</span> <span class="mi">0</span> <span class="k">END</span><span class="p">)</span> <span class="o">/</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>  <span class="k">as</span> <span class="n">percentage_high_elevation_airports</span> <span class="k">FROM</span> <span class="n">airports</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="k">state</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<h3 id="what-can-we-generalize-so-far_2">What can we generalize so far?<a class="headerlink" href="#what-can-we-generalize-so-far_2" title="Permanent link">&para;</a></h3>
<ul>
<li>Conditional Aggregates are aggregate functions the compute a result set based on a given set of conditions.</li>
<li><code class="codehilite">NULL</code> can be used to denote an empty field value</li>
<li><code class="codehilite">CASE</code> statements allow for custom classification of data</li>
<li><code class="codehilite">CASE</code> statements can be used inside aggregates (like <code class="codehilite">SUM()</code> and <code class="codehilite">COUNT()</code>) to provide filtered measures</li>
</ul>
<h2 id="date-number-and-string-functions">Date, Number, and String Functions<a class="headerlink" href="#date-number-and-string-functions" title="Permanent link">&para;</a></h2>
<p>Oftentimes, data in columns of tables is not in the exact format we need to complete our desired analysis. We may need to extract a date from a full timestamp, manipulate a number, or combine first and last name columns to create a full name.</p>
<p>In this lesson, we&rsquo;ll be learning about some of SQL&rsquo;s built-in functions for transforming dates, numbers and strings. We&rsquo;ll be using database of bakeries in this lesson.</p>
<p>It is important to note that date, number, and string functions are highly database dependent. Here, we focus on built-in functions in the SQLite database management system.</p>
<p>Select ten rows from the bakeries table:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">bakeries</span> <span class="k">LIMIT</span> <span class="mi">10</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>We&rsquo;ll begin with dates. Dates are often written in the following format</p>
<ol>
<li>Date: &ldquo;YYYY-MM-DD&rdquo;</li>
<li>Datetime or Timestamp: &ldquo;YYYY-MM-DD hh: mm:ss&rdquo;</li>
</ol>
<p>We can use SQL&rsquo;s date functions to transform data into a desired format. Since date functions can be database specific, verify the functions that exist on your relational database management system. For example, this statement:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">DATETIME</span><span class="p">(</span><span class="n">manufacture_time</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">baked_goods</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Using the datetime function, select the date and time of all deliveries in the <code class="codehilite">baked_goods</code> table using the column <code class="codehilite">delivery_time</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">DATETIME</span><span class="p">(</span><span class="n">delivery_time</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">baked_goods</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Now let&rsquo;s assume that we have a column in our <code class="codehilite">baked_goods</code> table named <code class="codehilite">manufacture_time</code> in the format &ldquo;YYYY-MM-DD hh: mm:ss&rdquo;. We&rsquo;d like to know the number of baked_goods manufactured by day, and not by second. We can use the <code class="codehilite">DATE()</code> function to easily convert timestamps to dates and complete the following query:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="nb">DATE</span><span class="p">(</span><span class="n">manufacture_time</span><span class="p">),</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">as</span> <span class="n">count_baked_goods</span>
<span class="k">FROM</span> <span class="n">baked_goods</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="nb">DATE</span><span class="p">(</span><span class="n">manufacture_time</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>Similarly, we can query the time with:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">TIME</span><span class="p">(</span><span class="n">manufacture_time</span><span class="p">),</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">as</span> <span class="n">count_baked_goods</span>
<span class="k">FROM</span> <span class="n">baked_goods</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">TIME</span><span class="p">(</span><span class="n">manufacture_time</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>Find the number of baked goods by date of delivery. Be sure to alias the total count of baked goods as <code class="codehilite">count_baked_goods</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="nb">DATE</span><span class="p">(</span><span class="n">delivery_time</span><span class="p">),</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">as</span> <span class="n">count_baked_goods</span> <span class="k">FROM</span> <span class="n">baked_goods</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="nb">DATE</span><span class="p">(</span><span class="n">delivery_time</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>Given a datepart and a column of date or timestamp data type, we can increment date or timestamp values by a specified interval. For example, in SQLite, the statement:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">DATETIME</span><span class="p">(</span><span class="n">time1</span><span class="p">,</span> <span class="s1">&#39;+3 hours&#39;</span><span class="p">,</span> <span class="s1">&#39;40 minutes&#39;</span><span class="p">,</span> <span class="s1">&#39;2 days&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>Would return a time 3 hours, 20 minutes, and 2 days after time1.</p>
<p>Imagine that each dessert in our <code class="codehilite">baked_goods</code> table is inspected 2 hours, 30 minutes, and 1 day after the manufacture time. To derive the inspection date for each baked good, we can use the following query:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">DATETIME</span><span class="p">(</span><span class="n">manufacture_time</span><span class="p">,</span> <span class="s1">&#39;+2 hours&#39;</span><span class="p">,</span> <span class="s1">&#39;30 minutes&#39;</span><span class="p">,</span> <span class="s1">&#39;1 day&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inspection_time</span>
<span class="k">FROM</span> <span class="n">baked_goods</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Each of the baked goods is packaged by Baker&rsquo;s Market exactly five hours, twenty minutes, and two days after the delivery (designated by delivery_time). Create a query returning all the packaging times for the goods in the <code class="codehilite">baked_goods</code> table. Be sure to alias the package time column as <code class="codehilite">package_time</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">DATETIME</span><span class="p">(</span><span class="n">delivery_time</span><span class="p">,</span> <span class="s1">&#39;+5 hours&#39;</span><span class="p">,</span> <span class="s1">&#39;20 minutes&#39;</span><span class="p">,</span> <span class="s1">&#39;2 days&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">package_time</span>
<span class="k">FROM</span> <span class="n">baked_goods</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Numeric functions can be used to transform numbers. Some common SQLite mathematical functions are included below that take numeric data types as inputs:</p>
<ul>
<li><code class="codehilite">SELECT (number1 + number2);</code>: returns the sum of two numbers. Similar, SQL can be used for subtraction, multiplication, and division.</li>
<li><code class="codehilite">SELECT CAST(number1 AS REAL) / number3;</code>: returns the result as a real number by casting one of the values as a real number, rather than an integer.</li>
<li><code class="codehilite">SELECT ROUND(number, precision);</code>: returns the numeric value rounded off to the next value specified.</li>
</ul>
<p>In our <code class="codehilite">baked_goods</code> table, we have information about cost designated by <code class="codehilite">ingredients_cost</code>. For accounting purposes, we&rsquo;d like to make sure that each ingredient cost is rounded to four decimal places rather than two, to account for currency fluctuations.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">ROUND</span><span class="p">(</span><span class="n">ingredients_cost</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="k">as</span> <span class="n">rounded_cost</span>
<span class="k">FROM</span> <span class="n">baked_goods</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Find the bakery&rsquo;s distance from the market rounded to two decimal places. Be sure to alias the column as <code class="codehilite">distance_from_market</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">ROUND</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">as</span> <span class="n">distance_from_market</span>
<span class="k">FROM</span> <span class="n">bakeries</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>A couple more useful numeric SQL functions are included below: <code class="codehilite">MAX</code> and <code class="codehilite">MIN</code>. <code class="codehilite">MAX(n1,n2,n3,...)</code>: returns the greatest value in the set of the input numeric expressions <code class="codehilite">MIN(n1,n2,n3,...)</code>: returns the least value in the set of the input numeric expressions</p>
<p>In our <code class="codehilite">baked_goods table</code>, in addition to the numeric <code class="codehilite">ingredients_cost</code> we have information about the packaging cost located in the packaging_cost column. We can use the MAX function to determine the overall greatest value of cost for each item using the following query:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span> <span class="k">MAX</span><span class="p">(</span><span class="n">ingredients_cost</span><span class="p">,</span> <span class="n">packaging_cost</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">baked_goods</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>We also have information about cook time designated as cook_time and cool down time designated as <code class="codehilite">cool_down_time</code> in the <code class="codehilite">baked_goods</code> table. Find the greatest time value for each item in the table.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span> <span class="k">MAX</span><span class="p">(</span><span class="n">cook_time</span><span class="p">,</span> <span class="n">cool_down_time</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">baked_goods</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Find the least time value for each item in the table.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span> <span class="k">MIN</span><span class="p">(</span><span class="n">cook_time</span><span class="p">,</span> <span class="n">cool_down_time</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">baked_goods</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>String manipulation can be useful to derive information from columns. We&rsquo;ll cover a couple of the common string functions here.</p>
<p>A common use case for string manipulation in SQL is concatenation of strings. In SQLite, this is written as:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">string1</span> <span class="o">||</span> <span class="s1">&#39; &#39;</span> <span class="o">||</span> <span class="n">string2</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>For example, the bakeries table contains both city and state columns. In order to create a route for these columns, we use the <code class="codehilite">||</code> function to concatenate them as in the following query:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">city</span> <span class="o">||</span> <span class="s1">&#39; &#39;</span> <span class="o">||</span> <span class="k">state</span> <span class="k">as</span> <span class="k">location</span>
<span class="k">FROM</span> <span class="n">bakeries</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>String functions are again, very database specific, and it is best practice to consult documentation before proceeding. </p>
<p>Combine the <code class="codehilite">first_name</code> and <code class="codehilite">last_name</code> columns from the bakeries table as the full_name to identify the owners of the bakeries. Be sure to add a space between the names in the <code class="codehilite">full_name</code> as shown in the example.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">first_name</span> <span class="o">||</span> <span class="s1">&#39; &#39;</span> <span class="o">||</span> <span class="n">last_name</span> <span class="k">as</span> <span class="n">full_name</span> <span class="k">FROM</span> <span class="n">bakeries</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Another useful string function in SQL is <code class="codehilite">REPLACE()</code>:</p>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">REPLACE</span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="n">from_string</span><span class="p">,</span><span class="n">to_string</span><span class="p">)</span>
</pre></div>
</td></tr></table><br />
The function returns the string string with all occurrences of the string <code class="codehilite">from_string</code> replaced by the string to_string. For example in <code class="codehilite">baked_goods</code>, there is a column named ingredients. The ingredients strings are formatted with underscores, such as <code class="codehilite">baking_soda</code> and <code class="codehilite">vanilla_extract</code>. To make these values more readable, we might like to replace the underscores with spaces. We can do so by using the following query:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span> <span class="k">REPLACE</span><span class="p">(</span><span class="n">ingredients</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">item_ingredients</span>
<span class="k">from</span> <span class="n">baked_goods</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Any time <code class="codehilite">enriched_flour</code> appears in the ingredients list, we’d like to replace it with just flour. Apply this transformation and also be sure to remove the underscore in <code class="codehilite">enriched_flour</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="k">REPLACE</span><span class="p">(</span><span class="n">ingredients</span><span class="p">,</span><span class="s1">&#39;enriched_&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">item_ingredients</span>
<span class="k">FROM</span> <span class="n">baked_goods</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<h3 id="what-can-we-generalize-so-far_3">What can we generalize so far?<a class="headerlink" href="#what-can-we-generalize-so-far_3" title="Permanent link">&para;</a></h3>
<ul>
<li>Date Functions:<ul>
<li><code class="codehilite">DATETIME</code>; Returns the date and time of the column specified. This can be modified to return only the date or only the time.</li>
<li><code class="codehilite">DATETIME(time1, +X hours, Y minutes, Z days)</code>: Increments the specificed column by a given number of hours, minutes, or days.</li>
</ul>
</li>
<li>Numeric Functions:<ul>
<li><code class="codehilite">(number1 + number2);</code>: Returns the sum of two numbers, or other mathematical operations, accordingly.</li>
<li><code class="codehilite">CAST(number1 AS REAL) / number2;</code>: Returns the result as a real number by casting one of numeric inputs as a real number</li>
<li><code class="codehilite">ROUND(number, precision);</code>: Returns the numeric value rounded off to the next value specified.</li>
</ul>
</li>
<li>String Functions:<ul>
<li><code class="codehilite">&#39;string1&#39; || &#39; &#39; || &#39;string2&#39;;</code>: Concatenates string1 and string 2, with a space between.</li>
<li><code class="codehilite">REPLACE(string,from_string,to_string)</code>: Returns the string with all occurrences of the string <code class="codehilite">from_string</code> replaced by the string <code class="codehilite">to_string</code>.</li>
</ul>
</li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../codecademy_sql_analyzing_business_metrics/" title="Codecademy, SQL, Analyzing Business Metrics" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Codecademy, SQL, Analyzing Business Metrics
              </span>
            </div>
          </a>
        
        
          <a href="../introduction_to_sql_joins/" title="Introduction to SQL JOINs" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Introduction to SQL JOINs
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.b41f3d20.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
    
      
        <script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-93008985-3","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(a){a.host!=document.location.host&&a.addEventListener("click",function(){var e=a.getAttribute("data-md-action")||"follow";ga("send","event","outbound",e,a.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
  </body>
</html>